{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "dependencyDashboard": true,
  "ignorePaths": [
    "**/deps/**",
    "**/node_modules/**",
    "**/vendor/**"
  ],
  "regexManagers": [
    {
      "fileMatch": [
        "clusters/lib/**/chartfile.yaml"
      ],
      "matchStrings": [
        "renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)( registryUrl=(?<registryUrl>.*?))?( versioning=(?<versioning>.*?))?( depType=(?<depType>.*?))?\\s*(version|tag):\\s*(?<currentValue>.*)"
      ],
      "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}"
    }
  ],
  "packageRules": [
    {
      "matchManagers": [
        "helm-values"
      ],
      "enabled": false
    },
    {
      "matchDepTypes": [
        "action"
      ],
      "pinDigests": true
    },
    {
      "matchFiles": [
        "clusters/lib/**/chartfile.yaml"
      ],
      "postUpgradeTasks": {
        "commands": [
          "curl -sL -o- https://get.helm.sh/helm-v$(awk '/^helm / { print $2 }' .tool-versions)-linux-amd64.tar.gz | tar xz --strip-components=1 -C /usr/local/bin/ linux-amd64/helm && chmod +x /usr/local/bin/helm",
          "curl -sL -o /usr/local/bin/tk https://github.com/grafana/tanka/releases/download/v$(awk '/^tanka / { print $2 }' .tool-versions)/tk-linux-amd64 && chmod +x /usr/local/bin/tk",
          "tk tool charts vendor"
        ],
        "fileFilters": [
          "clusters/lib/**/chartfile.yaml",
          "clusters/lib/**/charts/**"
        ]
      }
    }
  ]
}
